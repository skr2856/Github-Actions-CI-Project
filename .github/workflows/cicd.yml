# --------------------------------------------------
# EMAIL AUTH VERIFICATION (DEBUG JOB)
# --------------------------------------------------
email-verification:
  runs-on: self-hosted
  environment: My-CI-pipeline-envs
  steps:
    # 1️⃣ Verify secrets are visible
    - name: Debug Gmail Secrets
      run: |
        echo "GMAIL_USERNAME present: ${{ secrets.GMAIL_USERNAME != '' }}"
        echo "GMAIL_APP_PASSWORD present: ${{ secrets.GMAIL_APP_PASSWORD != '' }}"

    # 2️⃣ Send simple test email
    - name: Send Test Email (Gmail SMTP)
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        secure: false
        username: ${{ secrets.GMAIL_USERNAME }}
        password: ${{ secrets.GMAIL_APP_PASSWORD }}
        from: GitHub CI <${{ secrets.GMAIL_USERNAME }}>
        to: vijayakumarbl276@gmail.com
        subject: "✅ Gmail SMTP Test – GitHub Actions"
        body: |
          Hi Vijay,

          This is a test email to verify Gmail SMTP authentication
          using GitHub Actions Environment secrets.

          If you received this email:
          ✔️ Environment secrets are working
          ✔️ Gmail App Password is valid
          ✔️ SMTP configuration is correct

          Regards,
          GitHub Actions
